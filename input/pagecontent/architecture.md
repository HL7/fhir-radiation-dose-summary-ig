In this section, we describe the relationship between the different profiled resources.

### Profiles relationship

![Profiles relationship](./archi.png){: width="900px"}

<br clear="all" />

There are two levels or resources:
* Radiation Observation resources: these resources allows to describe a performed procedure, as seen from modality perspective. It summarize the radiation report generated by the modality.
* Radiation Report resources: the resources: these resources reference the radiation observation resources, and enhance the collected information in a general radiation report, with relationship to the patient conditions and the procedure indications.

A general Dose Summary profile is defined, and extended by three different Profiles:
* CT Dose Summary Profile 
* X-Ray Dose Summary Profile
* NM Dose Summary Profile

A general Irradiation Event profile is defined, and extended by on profile: CT Irradiation Event. Following the analysis of different national and regional recommendation, only a need for CT Irradiation event was found, the details of X-Ray and NM irradiations events were not highlighted as needed during a radiation summary report. Thus, no Profiles related to X-Ray and NM irradiation events were created.

### Actors communication

The following sequence diagram describes the typical workflow between the RDSP actor, the FHIR server, and the RDSC actor.

![Actors relationship](./seq.png){: width="900px"}

<br clear="all" />

During this workflow, a patient arrive to the hosptial and perform an exam within an irradiating modality. The detailed radiation information are shared with the Radiation Dose Summary Producer actor, which may generally be a Dose Management System. 
During the process of creating the Radiation Dose Summary resources, the RDSP actor perform a list of query to the FHIR server, in order to collect the right IDs to be referred in the newly created resources. The RDSP shall for instance collect the corresponding IDs for the Patient, the Practitioner, the Modality, and the ImagingStudy resources. Most of these resources can be identified from the DICOM RDSR shared from the modality. Some unique identifiers can be used to query the FHIR server. Here is a mapping between the FHIR resources and the identifiers from DICOM:

| FHIR Resource        |      Identifier from DICOM       |
|--------------------------|-----------------------|
| Patient | tag(0010,0020) Patient ID |
| Practitioner | TID 1020(Person Participant).EV (113871, DCM, "Person ID") |
| ImagingStudy | tag(0020,000D) Study Instance UID |
| Device | tag(0018,1000) Device Serial Number |
{:.table-striped .table-bordered}

The IDs collected are used to construct the Radiation Dose Summary resources and their related Irradiation Event resources. Then, these resources are shared with the FHIR server through a POST of a bundle. The bundle may contains temporary resources related to Patient, ImagingStudy, and other contextual resources, if the FHIR server has no reference of them.

Once the resources are shared with the FHIR server, the Radiation Dose Summary Consumer can search and retrieve the resources from the FHIR server and use them for their own purpose. The RDSC actor can optionnaly enrich the FHIR server resources by posting a Composition document as profiled by the Radiation Summary Report.