This chapter describes the different architecture aspects of the resources, profiles and actors identified within the IG.

1. [Profiles & Extensions](#profiles) - FHIR Profiles and extensions defined in the IG
2. [Actors](#actors) - Actors participating in the IG
3. [Terminology](#terminology) - Value Sets defined
4. [Resources Identifiers](#identifiers) - A focus on DICOM identifiers types
5. [Must Support](#must-support) - A focus on Must Support usage in this IG
5. [Security Consideration](#sec) - Security aspects to be taken in consideration

<a name="profiles"></a>

### Profiles & Extensions
#### Resource Profiles<a name="resources"></a>
* [Radiation Dose Summary](StructureDefinition-radiation-dose-summary.html) profiles the Observation resource to provide the base for the Radiation Dose Summary reporting.
    * [CT Radiation Dose Summary](StructureDefinition-ct-radiation-dose-summary.html) profiles the Observation resource by extending the Radiation Dose Summary profile with minimal dose information related to CT procedures.
    * [X-Ray Radiation Dose Summary](StructureDefinition-xray-radiation-dose-summary.html) profiles the Observation resource by extending the Radiation Dose Summary profile with minimal dose information related to X-Ray procedures (XA, RF, MG, etc.).
    * [Radiopharmaceutical Radiation Dose Summary](StructureDefinition-nm-radiation-dose-summary.html) profiles the Observation resource by extending the Radiation Dose Summary profile with minimal dose information related to nuclear medicine imaging procedures.
* [Irradiation Event Summary](StructureDefinition-irradiation-event-summary.html) profiles the Observation resource in order to describe minimal dose information related to irradiation events.
    * [CT Irradiation Event Summary](StructureDefinition-ct-irradiation-event-summary.html) profiles the Observation resource by extending Irradiation Event Summary profile, and adding minimal dose information related to CT Irradiation Events.
* [Radiation Summary Report](StructureDefinition-radiation-summary-report.html) profiles Composition resource and defines a report document describing the irradiation act.
* [Indication Observation](StructureDefinition-indication-observation.html) profiles Observation resource to provide the indications related to the performed procedure.
* [Pregnancy Status (IPS)](http://hl7.org/fhir/uv/ips/STU1/StructureDefinition-Observation-pregnancy-status-uv-ips.html){:target="_blank"} profiles Observation resource to provide the pregnancy status of the patient. The Pregnancy Status profile is defined within the [International Patient Summary IG (IPS)](https://hl7.org/fhir/uv/ips/STU1/){:target="_blank"}.
* [Modality Device](StructureDefinition-modality-device.html) profiles Device resource to provide the specificities of a modality as a Device resource.

#### Supporting DataType Profiles <a name="datatypes"></a>
There is no special supporting DataType profiles defined by this IG.

#### Supporting Extensions<a name="extensions"></a>
There is no special supporting extensions defined by this IG.

#### Profiles relationship
![Profiles relationship](./archi.svg){: width="110%"}

<br clear="all" />

There are two levels or profiles:
* Radiation Observation profiles: these profiles allow describing a performed radiation act, as seen from modality perspective. They summarize the radiation report generated by the modality. These radiation observation profiles are [Radiation Dose Summary](StructureDefinition-radiation-dose-summary.html), [CT Radiation Dose Summary](StructureDefinition-ct-radiation-dose-summary.html), [X-Ray Radiation Dose Summary](StructureDefinition-xray-radiation-dose-summary.html), [Radiopharmaceutical Radiation Dose Summary](StructureDefinition-nm-radiation-dose-summary.html), [Irradiation Event Summary](StructureDefinition-irradiation-event-summary.html), and [CT Irradiation Event Summary](StructureDefinition-ct-irradiation-event-summary.html) (they are presented in green in the class diagram above).
* Radiation Report profiles: these profiles reference the radiation observation resources, and enhance the collected information in a general radiation report, with relationship to the patient conditions and the procedure indications. These reporting profiles are [Radiation Summary Report](StructureDefinition-radiation-summary-report.html), [Indication Observation](StructureDefinition-indication-observation.html), and [Pregnancy Status (IPS)](http://hl7.org/fhir/uv/ips/STU1/StructureDefinition-Observation-pregnancy-status-uv-ips.html){:target="_blank"}. The two latter profiles contain information collected before patient imaging procedure, which explain the two levels of profiles.

A general Dose Summary profile is defined, and extended by three different Profiles:
* CT Dose Summary Profile 
* X-Ray Dose Summary Profile
* NM Dose Summary Profile

These extensions follow DICOM standard, which had already defined three types of structured report templates, related to each one of these profiles:
* [CT Radiation Dose SR IOD Templates](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CTRadiationDoseSRIODTemplates.html){:target="_blank"}
* [X-Ray Radiation Dose SR IOD Templates](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_XRayRadiationDoseSRIODTemplates.html){:target="_blank"}
* [Radiopharmaceutical Radiation Dose SR IOD Templates](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_RadiopharmaceuticalRadiationDoseSRIODTemplates.html){:target="_blank"}

A general Irradiation Event profile is defined, and extended by on profile: CT Irradiation Event. Following the analysis of different national and regional recommendations, only a need for CT Irradiation event profiling was found, the details of X-Ray and NM irradiations events were not highlighted as needed during a radiation summary report. Thus, no Profiles related to X-Ray and NM irradiation events were created.

<a name="components"></a>
Radiation Dose Summary profiles are using the component element to describe the different parameters of the radiation procedure. We consider that the attributes of the components in the radiation summary resources are part of the resource itself, which cannot be understood without reading the complete different components. Having different Observations referenced in multiple hasMember elements is not useful, as the interpretation of the radiation dose summary resource needs to access to all the different parameters of the radiation procedure. For example, in [Radiopharmaceutical Radiation Dose Summary](StructureDefinition-nm-radiation-dose-summary.html), the component [administered activity](StructureDefinition-nm-radiation-dose-summary-definitions.html#Observation.component:administeredActivity) cannot be dissociated from the component [radiophamaceutical](StructureDefinition-nm-radiation-dose-summary-definitions.html#Observation.component:radiopharmaceutical). In fact, the value of the administered activity is meaningless without the radiopharmaceutical value. Another example is the [CT Irradiation Event Summary](StructureDefinition-ct-irradiation-event-summary.html) profile. The component [meanCTDIvol](StructureDefinition-ct-irradiation-event-summary-definitions.html#Observation.component:meanCTDIvol) is meaningless at its own, without the value of the component [ctdiPhantomType](StructureDefinition-ct-irradiation-event-summary-definitions.html#Observation.component:ctdiPhantomType). Also, the [DLP](StructureDefinition-ct-irradiation-event-summary-definitions.html#Observation.component:dlp) is derived from the CTDIvol. The same interpretation can be done for the other components in the Radiation Dose Summary profiles.


<a name="actors"></a>

### Actors
A list of actors are identified within this IG:
* Radiation Dose Summary Producer
* FHIR Server
* Radiation Dose Summary Consumer

![Actors](./actors.svg){: width="100%"}

<br clear="all" />

#### Radiation Dose Summary Producer
The Radiation Dose Summary Producer (RDSP) actor is responsible on the creation of the Radiation Dose Summary observation, and sharing it with the FHIR Server. The RDSP actor shall consider synchronizing with the FHIR server multiple resources, in order to avoid duplicating resources in the FHIR server. For example, the RDSP actor shall check if the patient already exists in the FHIR server, and if so, only a reference to this patient is created, and the POST bundle from the RDSP actor to the FHIR server shall not contain a Patient resource.
Generally, this actor can be implemented within a Dose Management System.

The RDSP actor can implement the following CapabilityStatement: [RDSP capability statement](CapabilityStatement-RDSP.html).

#### FHIR Server
The FHIR Server has two functions:
1. Provide the diagnostic procedure context to both the Radiation Dose Summary Producer and Consumer actors
2. Store the Radiation Dose Summary resources and Irradiation Event resources from the sharing performed from the Producer actor

Thus, the FHIR server can be divided in fact in two sub-actors: one for the contextual resources, and one for the Radiation Dose resources.

The contextual resources are resources managed by the FHIR server and related to the imaging procedure, and works as a source of truth for these resources:
1. The Patient resources: the patients having exams.
2. The Device resources: the modalities participating in the irradiation of the patients.
3. The Practitioner resources: the irradiation authorizing persons responsible on the performed exams.
4. The ImagingStudy resources: resources describing the performed exams.

When these resources are not present in the FHIR server, the Radiation Dose Summary Producer can take the responsibility on alimenting the FHIR server with these resources, by creating them from the RDSRs and images collected from modalities.

The FHIR server can implement the following CapabilityStatements:
* [FHIRServer-RDSP](CapabilityStatement-FHIRServer-RDSP.html) - Requirements for FHIR server interacting with RDSP actor
* [FHIRServer-RDSC](CapabilityStatement-FHIRServer-RDSC.html) -  Requirements for FHIR server interacting with RDSC actor
* [FHIRServer](CapabilityStatement-FHIRServer.html) - Requirements for FHIR server actor

#### Radiation Dose Summary Consumer
The Radiation Dose Summary Consumer (RDSC) actor is responsible on the collection and interpretation of the Radiation Dose Summary observation. There are many ways to use the Radiation Dose Summary resources, and it depends on the consumer.
* RIS systems can act as consumer actor, in order to enhance the final radiology report with radiation information. 
* Clinical Decision Support tools can use these radiation resources to feed their algorithms.
* Clinical Quality Information tools can use these radiation resources to perform analyzes on radiations information, and provide metrics related to patients cohorts, or devices comparison, or limit values calculations, etc.
* Other consumers may act as a light Dose registry, by collecting the radiation summary information for a patient or a group of patients in a regional or national infrastructure. Such registries can create valuable data for regulations purpose, or for population radiation estimations.

The RDSC actor can implement the following CapabilityStatement: [RDSC capability statement](CapabilityStatement-RDSC.html).

#### Actors grouping
The FHIR Server can be grouped with the Radiation Dose Summary Producer actor within the Dose Management System. Thus, the Dose Management System is managing all the resources and references between resources. Another possible grouping is between the FHIR Server and the Radiation Dose Summary Consumer actor. This can happen for example within EMR systems or RIS/EHR systems. In this case, the source of truth for contextual resources are independent from the Radiation Dose Summary Producer.

#### Actors communication

The following sequence diagram describes the typical workflow between the RDSP actor, the FHIR server, and the RDSC actor.

![Actors relationship](./seq-simplified.svg){: width="900px"}

<br clear="all" />

During this workflow, a patient arrives to the hospital and performs an exam within an irradiating modality, or including a nuclear medicine administration. The detailed radiation information is shared with the Radiation Dose Summary Producer actor, which may generally be a Dose Management System. 
During the process of creating the Radiation Dose Summary resources, the RDSP actor performs a list of queries to the FHIR server, in order to collect the right IDs to be referred in the newly created resources. For instance, the RDSP actor shall collect the corresponding IDs for the Patient, the Practitioner, the Modality, and the ImagingStudy resources. Most of these resources can be identified from the DICOM RDSR shared from the modality. Some unique identifiers within the RDSR can be used to query the FHIR server. Here is a mapping between the FHIR resources and the identifiers from DICOM:

| FHIR Resource        |      Identifier from DICOM       |
|--------------------------|-----------------------|
| Patient | tag(0010,0020) Patient ID |
| Practitioner | TID 1020(Person Participant).EV (113871, DCM, Person ID) |
| ImagingStudy | tag(0020,000D) Study Instance UID |
| Device | tag(0018,1000) Device Serial Number |
{:.table-striped .table-bordered}

The IDs collected are used to construct the Radiation Dose Summary resources and their related Irradiation Event resources. Then, these resources are shared with the FHIR server through a POST of a bundle. The bundle may contain temporary resources related to Patient, ImagingStudy, and other contextual resources, if the FHIR server has no reference of them.

Once the resources are shared with the FHIR server, the Radiation Dose Summary Consumer can search and retrieve the resources from the FHIR server and use them for their own purposes. The RDSC actor can optionally enrich the FHIR server resources by posting a Composition document as profiled by the Radiation Summary Report profile.


<a name="terminology"></a>

### Terminology

#### Value Sets Defined
These Value Sets have been defined for this implementation guide.

1. [Isotopes Value Set](ValueSet-isotope-rds-vs.html)
2. [Procedure Reported Type Value Set](ValueSet-procedure-reported-type-rds-vs.html)
3. [Radiopharmaceuticals Value Set](ValueSet-radiopharmaceutical-rds-vs.html)
4. [Radiation Dose Summary component type](ValueSet-component-radiation-dose-summary-vs.html)
5. [Irradiation Event component type](ValueSet-component-irradiation-event-vs.html)

#### Value Sets Used
DICOM ValueSet links:
1. [CID 4030 CT, MR and PET Anatomy Imaged](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_4030.html){:target="_blank"}
2. [CID 4052 Phantom Devices](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_4052.html){:target="_blank"}
3. [CID 33 Modality](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_33.html){:target="_blank"}
4. [CID 11 Route of Administration](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_11.html){:target="_blank"}
5. [CID 25 Radiopharmaceuticals](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_25.html){:target="_blank"}
6. [CID 4021 PET Radiopharmaceutical](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_4021.html){:target="_blank"}
7. [CID 18 Isotopes in Radiopharmaceuticals](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_18.html){:target="_blank"}
8. [CID 4020 PET Radionuclide](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_4020.html){:target="_blank"}

#### Code Systems Defined
One new code system is defined under this IG:
1. [DICOM Identifier Type](CodeSystem-dicom-identifier-type.html)

#### Code Systems Used
This implementation guide draws on a number of formal code systems.

The following table presents the external code systems (and naming conventions) adopted in this implementation guide: 

| Code System Key | Code System Name | Code System | Application |
|--------------------------|-----------------------|--------------|---------------|
| LOINC | Logical Observation Identifiers Names and Codes | http://loinc.org | Observation and laboratory codes |
| SNOMED CT | Systematized Nomenclature of Medicine Clinical Terms | http://snomed.info/sct | Procedures, anatomy, products, isotopes |
| DCM | DICOM | http://dicom.nema.org/resources/ontology/DCM | Devices, products, radiation information |
{:.table-striped .table-bordered}

#### Value Sets strength
The following table summarizes the mapping between defined profiles and Value sets strength : 
 
| Profile | Element path | Value Set | Strength | Strength Justification |
|---------|--------------|-----------|----------|------------------------|
| CT Irradiation Event Summary | bodySite | [CID 4030 CT, MR and PET Anatomy Imaged](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_4030.html){:target="_blank"} | extensible | Following DICOM [TID 10013](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_10013.html){:target="_blank"} |
| CT Irradiation Event Summary | component:ctdiPhantomType | [CID 4052 Phantom Devices](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_4052.html){:target="_blank"} | extensible | Following DICOM [TID 10013](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_10013.html){:target="_blank"} |
| Irradiation Event Summary | component.code | [Components' Code for Irradiation Event](ValueSet-component-irradiation-event-vs.html) | extensible | to keep the possibility to extend the list of reported components |
| Modality Device | type | [CID 33 Modality](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_33.html){:target="_blank"} | required | VS contains the exhaustive list of modality types |
| Radiopharmaceutical Radiation Dose Summary | component:radiopharmaceutical | [Radiopharmaceuticals Value Set](ValueSet-radiopharmaceutical-rds-vs.html) | extensible | Following DICOM [TID 10022](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_10022.html){:target="_blank"} |
| Radiopharmaceutical Radiation Dose Summary | component:radioisotope | [Isotopes Value Set](ValueSet-isotope-rds-vs.html) | extensible | Following DICOM [TID 10022](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_10022.html){:target="_blank"} |
| Radiopharmaceutical Radiation Dose Summary | component:routeOfAdministration | [CID 11 Route of Administration](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_11.html){:target="_blank"} | preferred | Following DICOM [TID 10022](http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_10022.html){:target="_blank"} |
| Radiation Dose Summary | component.code | [Components' Code for Radiation Dose Summary](ValueSet-component-radiation-dose-summary-vs.html) | extensible |  to keep the possibility to extend the list of reported components |
| Radiation Dose Summary | component:procedureReported | [Procedure Reported Type Value Set](ValueSet-procedure-reported-type-rds-vs.html) | required | procedure reported component is the distinguisher of irradiation type |
{:.table-striped .table-bordered}

<a name="identifiers"></a>

### Resources Identifiers

Many profiles defined in this IG are using DICOM IDs and UIDs as identifiers for the resources. In this paragraph, we summarize the different IDs and UIDs used, and the way they should be exposed in FHIR resources:

| Profile | Identifier | Identifier.system | Identifier.type.code | Identifier.type.system | Identifier.type.display | DICOM Tag Mapping |
|---------|------------|-------------------|----------------------|------------------------|-------------------------|---------|
| [Irradiation Event Summary](StructureDefinition-irradiation-event-summary.html) | identifier:irradiationEventUID | urn:dicom:uid | irradiation-event-uid | [DICOM Identifier Type](CodeSystem-dicom-identifier-type.html) | Irradiation Event UID | (0008,3010) Irradiation Event UID |
| [Modality Device](StructureDefinition-modality-device.html) | identifier:deviceSerialNumber | | SNO | [HL7 IdentifierType](http://terminology.hl7.org/CodeSystem/v2-0203){:target="_blank"} | Serial Number | (0018,1000) Device Serial Number |
| [Modality Device](StructureDefinition-modality-device.html) | identifier:aeTitle | | application-entity | [DICOM Identifier Type](CodeSystem-dicom-identifier-type.html) | Application Entity | N/A |
| [Modality Device](StructureDefinition-modality-device.html) | identifier:deviceUID | urn:dicom:uid | device-uid | [DICOM Identifier Type](CodeSystem-dicom-identifier-type.html) | Device UID | (0018,1002) Device UID |
| [Modality Device](StructureDefinition-modality-device.html) | identifier:deviceID | | device-id | [DICOM Identifier Type](CodeSystem-dicom-identifier-type.html) | Device ID | (0018,1003) Device ID |
| [Radiation Dose Summary](StructureDefinition-radiation-dose-summary.html) | identifier:radiationSRUID | urn:dicom:uid | sop-instance-uid | [DICOM Identifier Type](CodeSystem-dicom-identifier-type.html) | SOP Instance UID | (0008,0018) SOP Instance UID |
| [Radiation Dose Summary](StructureDefinition-radiation-dose-summary.html) | partOf.identifier | urn:dicom:uid | study-instance-uid | [DICOM Identifier Type](CodeSystem-dicom-identifier-type.html) | Study Instance UID | (0020,000D) Study Instance UID |
| [Radiation Dose Summary](StructureDefinition-radiation-dose-summary.html) | basedOn.identifier | | ACSN | [HL7 IdentifierType](http://terminology.hl7.org/CodeSystem/v2-0203){:target="_blank"} | Accession ID | (0008,0050) Accession Number |
{:.table-striped .table-bordered}

Following the notes within the [ImagingStudy](http://hl7.org/fhir/imagingstudy.html#notes) resource - <i>When encoding a DICOM UID in an Identifier datatype, use the Identifier system of "urn:dicom:uid"</i> - the identifiers related to DICOM tags having the Value Representation (VR) of type UID, shall have the <code>type.system=urn:dicom:uid</code>.

Here some examples :
* Irradiation Event UID : 
<pre class="json">
"identifier": [
    {
        "type": {
            "coding": [
                {
                    "system": "http://hl7.org/fhir/uv/radiation-dose-summary/CodeSystem/dicom-identifier-type",
                    "code": "irradiation-event-uid",
                    "display": "Irradiation Event UID"
                }
            ]
        },
        "system": "urn:dicom:uid",
        "value": "urn:oid:1.2.840.121.3.32.0.1.1323423.2"
    }
]
</pre>

* Application Entity :
<pre class="json">
"identifier": [
    {
        "type": {
            "coding": [
                {
                    "system": "http://hl7.org/fhir/uv/radiation-dose-summary/CodeSystem/dicom-identifier-type",
                    "code": "application-entity",
                    "display": "Application Entity"
                }
            ]
        },
        "value": "XA01"
    }
]
</pre>


<a name="must-support"></a>

### Must Support
In the context of this IG, mustSupport on any data element SHALL be interpreted as follows:

* When creating Radiation Dose Summary content, implementers SHALL be capable of including mustSupport data elements.
* When receiving Radiation Dose Summary content, implementers:
    * SHALL be capable of processing resource instances containing mustSupport data elements without generating an error or causing the application to fail.
    * SHOULD be capable of displaying mustSupport data elements for human use, or processing (e.g., storing) them for other purposes.

<a name="sec"></a>

### Security Consideration
Exchanging Radiation summary resources makes use of patient-specific information which could be exploited by malicious actors resulting in exposure of patient data. For these reasons, all data exchange between the different actors must be secured appropriately with access to limited authorized individuals, data protected in transit, and appropriate audit measures taken. 

Implementers SHOULD be aware of these [security considerations](http://hl7.org/fhir/R4/security.html){:target="_blank"} associated with FHIR transactions, particularly those related to:

* [Communications](http://hl7.org/fhir/R4/security.html#http){:target="_blank"}
* [Authentication](http://hl7.org/fhir/R4/security.html#authentication){:target="_blank"}
* [Authorization/Access Control](http://hl7.org/fhir/R4/security.html#authorization/access%20control){:target="_blank"}
* [Audit Logging](http://hl7.org/fhir/R4/security.html#audit%20logging){:target="_blank"}
* [Digital Signatures](http://hl7.org/fhir/R4/security.html#digital%20signatures){:target="_blank"}
* [Security Labels](http://hl7.org/fhir/R4/security-labels.html){:target="_blank"}
* [Narrative](http://hl7.org/fhir/R4/security.html#narrative){:target="_blank"}

These security requirements are highlighted in the context of this IG:
* Systems **SHALL** keep audit logs of the various transactions. Some auditing workflows can be used like IHE ATNA or RESTful ATNA.
* Systems **SHALL** use TLS version 1.2 or higher for all transmissions not taking place over a secure network connection. IHE ATNA may be followed for the TLS usage.
* Systems **SHALL** conform to FHIR [Communications Security requirements](http://hl7.org/fhir/R4/security.html#http){:target="_blank"}.
* Systems **SHALL** implement consent requirements per their country, state, local, and institutional policies.

